graph TB
    subgraph "Guisu System"
        CLI["CLI Binary<br/>(guisu-cli)<br/>Commands & UI"]

        subgraph "Core Libraries"
            Engine["Engine<br/>(guisu-engine)<br/>State Management"]
            Template["Template<br/>(guisu-template)<br/>minijinja"]
            Config["Config<br/>(guisu-config)<br/>TOML Parser"]
            Crypto["Crypto<br/>(guisu-crypto)<br/>Age Encryption"]
            Vault["Vault<br/>(guisu-vault)<br/>Secret Providers"]
            Core["Core<br/>(guisu-core)<br/>Foundation Types"]
        end

        subgraph "External Storage"
            DB[(redb Database<br/>Persistent State)]
            SourceFS[Source Directory<br/>Repository Files]
            DestFS[Destination<br/>Home Directory]
        end

        CLI --> Engine
        CLI --> Template
        CLI --> Config

        Engine --> Core
        Engine --> Crypto
        Engine --> Template
        Engine --> Config
        Engine --> Vault

        Template --> Core
        Template --> Crypto
        Template --> Vault

        Config --> Core
        Config --> Crypto
        Config --> Template

        Crypto --> Core
        Vault -.->|Optional| Core

        Engine --> DB
        Engine --> SourceFS
        Engine --> DestFS
    end

    style CLI fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff
    style Engine fill:#2196F3,stroke:#1565C0,stroke-width:2px,color:#fff
    style Template fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff
    style Config fill:#9C27B0,stroke:#6A1B9A,stroke-width:2px,color:#fff
    style Crypto fill:#F44336,stroke:#C62828,stroke-width:2px,color:#fff
    style Vault fill:#795548,stroke:#4E342E,stroke-width:2px,color:#fff
    style Core fill:#607D8B,stroke:#37474F,stroke-width:2px,color:#fff
    style DB fill:#009688,stroke:#00695C,stroke-width:2px,color:#fff
    style SourceFS fill:#CDDC39,stroke:#9E9D24,stroke-width:2px,color:#000
    style DestFS fill:#FFC107,stroke:#F57F17,stroke-width:2px,color:#000
